# Vulnerability Protection Profile Configuration Object

The `VulnerabilityProtectionProfile` class provides functionality to manage vulnerability protection profiles in Palo
Alto Networks' Strata Cloud Manager. These profiles define rules and policies for detecting and preventing exploitation
of known vulnerabilities in network traffic.

## Overview

Vulnerability protection profiles in Strata Cloud Manager allow you to:

- Define rules for different vulnerability severities and categories
- Configure actions for detected vulnerabilities (alert, block, reset connections)
- Set up threat exceptions for specific cases
- Specify packet capture settings
- Track vulnerabilities by CVE or vendor ID
- Organize profiles within folders, snippets, or devices

The SDK provides comprehensive error handling and logging capabilities to help troubleshoot issues during profile
management.

## Methods

| Method     | Description                                                   |
|------------|---------------------------------------------------------------|
| `create()` | Creates a new vulnerability protection profile                |
| `get()`    | Retrieves a vulnerability protection profile by ID            |
| `update()` | Updates an existing vulnerability protection profile          |
| `delete()` | Deletes a vulnerability protection profile                    |
| `list()`   | Lists vulnerability protection profiles with optional filters |
| `fetch()`  | Retrieves a single vulnerability protection profile by name   |

## Exceptions

The SDK uses a hierarchical exception system for error handling:

### Client Errors (4xx)

- `InvalidObjectError`: Raised when profile data is invalid or malformed
- `MissingQueryParameterError`: Raised when required parameters (folder, name) are empty
- `NotFoundError`: Raised when a profile doesn't exist
- `AuthenticationError`: Raised for authentication failures
- `AuthorizationError`: Raised for permission issues
- `ConflictError`: Raised when profile names conflict
- `NameNotUniqueError`: Raised when creating duplicate profile names
- `ReferenceNotZeroError`: Raised when deleting profiles still referenced by policies
- `InputFormatMismatchError`: Raised when input data format is incorrect
- `OutputFormatMismatchError`: Raised when response format is incorrect
- `InvalidQueryParameterError`: Raised when query parameters are invalid
- `MissingBodyError`: Raised when request body is missing
- `InvalidCommandError`: Raised when an invalid command is issued
- `MalformedCommandError`: Raised when a command is malformed
- `BadXPathError`: Raised when an invalid XPath is used
- `ObjectNotPresentError`: Raised when referenced objects don't exist
- `ActionNotSupportedError`: Raised when an action is not supported

### Server Errors (5xx)

- `ServerError`: Base class for server-side errors
- `APINotImplementedError`: When API endpoint isn't implemented
- `VersionAPINotSupportedError`: When API version is not supported
- `MethodAPINotSupportedError`: When method is not supported
- `GatewayTimeoutError`: When request times out
- `SessionTimeoutError`: When the API session times out

## Creating Vulnerability Protection Profiles

The `create()` method allows you to create new vulnerability protection profiles with proper error handling.

**Example: Basic Profile with Single Rule**

<div class="termy">

```python
from scm.client import Scm
from scm.config.security import VulnerabilityProtectionProfile
from scm.exceptions import InvalidObjectError, NameNotUniqueError

# Initialize client with logging
client = Scm(
    client_id="your_client_id",
    client_secret="your_client_secret",
    tsg_id="your_tsg_id",
    log_level="DEBUG"  # Enable detailed logging
)

vulnerability_protection_profile = VulnerabilityProtectionProfile(client)

try:
    profile_data = {
        "name": "basic-profile",
        "description": "Basic vulnerability protection",
        "folder": "Shared",
        "rules": [
            {
                "name": "critical-vulns",
                "severity": ["critical"],
                "category": "code-execution",
                "action": {"block_ip": {"track_by": "source", "duration": 300}}
            }
        ]
    }

    new_profile = vulnerability_protection_profile.create(profile_data)
    print(f"Created profile: {new_profile.name}")

except NameNotUniqueError as e:
    print(f"Profile name already exists: {e.message}")
except InvalidObjectError as e:
    print(f"Invalid profile data: {e.message}")
    if e.details:
        print(f"Details: {e.details}")
```

</div>

**Example: Profile with Multiple Rules and CVEs**

<div class="termy">

```python
try:
    profile_data = {
        "name": "advanced-profile",
        "description": "Advanced vulnerability protection",
        "folder": "Shared",
        "rules": [
            {
                "name": "critical-cves",
                "severity": ["critical", "high"],
                "category": "command-execution",
                "cve": ["CVE-2021-44228", "CVE-2021-45046"],
                "action": {"reset_both": {}}
            },
            {
                "name": "medium-vulns",
                "severity": ["medium"],
                "category": "sql-injection",
                "action": {"alert": {}}
            }
        ]
    }

    new_profile = vulnerability_protection_profile.create(profile_data)
    print(f"Created profile: {new_profile.name}")

except InvalidObjectError as e:
    print(f"Invalid profile data: {e.message}")
    print(f"Error code: {e.error_code}")
    if e.details:
        print(f"Details: {e.details}")
```

</div>

## Getting Vulnerability Protection Profiles

Use the `get()` method to retrieve a vulnerability protection profile by its ID.

<div class="termy">

```python
try:
    profile_id = "123e4567-e89b-12d3-a456-426655440000"
    profile = vulnerability_protection_profile.get(profile_id)
    print(f"Profile Name: {profile.name}")
    print(f"Number of Rules: {len(profile.rules)}")

except NotFoundError as e:
    print(f"Profile not found: {e.message}")
except InvalidObjectError as e:
    print(f"Invalid profile ID: {e.message}")
```

</div>

## Updating Vulnerability Protection Profiles

The `update()` method allows you to modify existing vulnerability protection profiles.

<div class="termy">

```python
try:
    update_data = {
        "id": "123e4567-e89b-12d3-a456-426655440000",
        "description": "Updated profile description",
        "folder": "Shared",
        "rules": [
            {
                "name": "updated-rule",
                "severity": ["critical", "high"],
                "category": "exploit-kit",
                "action": {"reset_both": {}}
            }
        ],
        "threat_exception": [
            {
                "name": "exception-1",
                "packet_capture": "single-packet",
                "action": {"allow": {}},
                "exempt_ip": [{"name": "10.0.0.1"}]
            }
        ]
    }

    updated_profile = vulnerability_protection_profile.update(update_data)
    print(f"Updated profile: {updated_profile.name}")

except NotFoundError as e:
    print(f"Profile not found: {e.message}")
except InvalidObjectError as e:
    print(f"Invalid update data: {e.message}")
```

</div>

## Deleting Vulnerability Protection Profiles

Use the `delete()` method to remove a vulnerability protection profile.

<div class="termy">

```python
try:
    profile_id = "123e4567-e89b-12d3-a456-426655440000"
    vulnerability_protection_profile.delete(profile_id)
    print("Profile deleted successfully")

except NotFoundError as e:
    print(f"Profile not found: {e.message}")
except ReferenceNotZeroError as e:
    print(f"Profile still in use: {e.message}")
```

</div>

## Listing Vulnerability Protection Profiles

The `list()` method retrieves multiple vulnerability protection profiles with optional filtering. You can filter the
results using the following kwargs:

- `severity`: List[str] - Filter by rule severities (e.g., ['critical', 'high'])
- `action`: List[str] - Filter by rule actions (e.g., ['alert', 'block'])
- `threat_name`: List[str] - Filter by rule threat names

<div class="termy">

```python
try:
    # List all profiles in a folder
    profiles = vulnerability_protection_profile.list(
        folder="Shared"
    )

    # List profiles with critical severity rules
    critical_profiles = vulnerability_protection_profile.list(
        folder="Shared",
        severity=['critical']
    )

    # List profiles with specific actions
    alert_profiles = vulnerability_protection_profile.list(
        folder="Shared",
        action=['alert', 'block']
    )

    # List profiles with specific threat names
    threat_profiles = vulnerability_protection_profile.list(
        folder="Shared",
        threat_name=['Log4Shell', 'SQLi']
    )

    # Print the results
    for profile in profiles:
        print(f"Name: {profile.name}")
        for rule in profile.rules:
            print(f"Rule: {rule.name}, Severity: {rule.severity}")

except InvalidObjectError as e:
    print(f"Invalid filter parameters: {e.message}")
except MissingQueryParameterError as e:
    print(f"Missing required parameter: {e.message}")
```

</div>

## Fetching Vulnerability Protection Profiles

The `fetch()` method retrieves a single vulnerability protection profile by name from a specific container.

<div class="termy">

```python
try:
    profile = vulnerability_protection_profile.fetch(
        name="basic-profile",
        folder="Shared"
    )

    print(f"Found profile: {profile['name']}")
    print(f"Current rules: {len(profile['rules'])}")

except NotFoundError as e:
    print(f"Profile not found: {e.message}")
except MissingQueryParameterError as e:
    print(f"Missing required parameter: {e.message}")
```

</div>

## Full Workflow Example

Here's a complete example demonstrating the full lifecycle of a vulnerability protection profile with proper error
handling:

<div class="termy">

```python
from scm.client import Scm
from scm.config.security import VulnerabilityProtectionProfile
from scm.exceptions import (
    InvalidObjectError,
    NotFoundError,
    AuthenticationError,
    NameNotUniqueError,
    ReferenceNotZeroError
)

try:
    # Initialize client with debug logging
    client = Scm(
        client_id="your_client_id",
        client_secret="your_client_secret",
        tsg_id="your_tsg_id",
        log_level="DEBUG"  # Enable detailed logging
    )

    # Initialize vulnerability protection profile object
    vulnerability_protection_profile = VulnerabilityProtectionProfile(client)

    try:
        # Create new profile
        create_data = {
            "name": "test-profile",
            "description": "Test vulnerability protection",
            "folder": "Shared",
            "rules": [
                {
                    "name": "test-rule",
                    "severity": ["critical"],
                    "category": "code-execution",
                    "action": {"alert": {}}
                }
            ]
        }

        new_profile = vulnerability_protection_profile.create(create_data)
        print(f"Created profile: {new_profile.name}")

        # Fetch and update the profile
        try:
            fetched_profile = vulnerability_protection_profile.fetch(
                name="test-profile",
                folder="Shared"
            )
            print(f"Found profile: {fetched_profile['name']}")

            # Update the profile
            fetched_profile["description"] = "Updated test profile"
            updated_profile = vulnerability_protection_profile.update(fetched_profile)
            print(f"Updated description: {updated_profile.description}")

        except NotFoundError as e:
            print(f"Profile not found: {e.message}")

        # Clean up
        try:
            vulnerability_protection_profile.delete(new_profile.id)
            print("Profile deleted successfully")
        except ReferenceNotZeroError as e:
            print(f"Cannot delete profile - still in use: {e.message}")

    except NameNotUniqueError as e:
        print(f"Profile name conflict: {e.message}")
    except InvalidObjectError as e:
        print(f"Invalid profile data: {e.message}")
        if e.details:
            print(f"Details: {e.details}")

except AuthenticationError as e:
    print(f"Authentication failed: {e.message}")
    print(f"Status code: {e.http_status_code}")
```

</div>

## Related Models

- [VulnerabilityProtectionProfileCreateModel](../../models/security/vulnerability_protection_profile_models.md#vulnerabilityprotectionprofilecreatemodel)
- [VulnerabilityProtectionProfileUpdateModel](../../models/security/vulnerability_protection_profile_models.md#vulnerabilityprotectionprofileupdatemodel)
- [VulnerabilityProtectionProfileResponseModel](../../models/security/vulnerability_protection_profile_models.md#vulnerabilityprotectionprofileresponsemodel)